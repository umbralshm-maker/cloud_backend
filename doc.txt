DOCUMENTACIÃ“N TÃ‰CNICA â€” ESTADO FINAL (ENERO 2026)
1. Arquitectura final (estado estable)

Pipeline completo y operativo:

SHM local (Python)
   â””â”€ POST alert_immediate
   â””â”€ POST report_links
        â†“
FastAPI (Render)
   â””â”€ Persistencia PostgreSQL (Render Free)
        â†“
API REST (Swagger)


No hay Firebase.
No hay disco local.
No hay dependencias ocultas.

2. Backend cloud
URL base
https://shm-cloud-backend.onrender.com

Swagger
https://shm-cloud-backend.onrender.com/docs

3. Endpoints activos (contrato vigente)
ðŸ”¹ PublicaciÃ³n desde SHM
Alerta inmediata
POST /ingest/alert


Payload:

{
  "building_id": "Serapio RendÃ³n 87",
  "event_id": "16012026_04",
  "lambda_max": 1.04,
  "status": "NORMAL",          // opcional
  "event_time": "2026-01-17T01:30:00" // opcional
}


Notas:

building_key ELIMINADO

El backend puede inferir estado si no se manda

Update de links (no bloqueante)
POST /ingest/report_links


Payload:

{
  "building_id": "Serapio RendÃ³n 87",
  "event_id": "16012026_04",
  "reports": {
    "alerta":  { "share_link": "https://drive.google.com/..." },
    "evento":  { "share_link": "https://drive.google.com/..." },
    "mensual": { "share_link": "https://drive.google.com/..." }
  }
}


Notas:

No recalcula estado

Puede llegar minutos despuÃ©s

ðŸ”¹ Lectura / inspecciÃ³n
Ver edificios y Ãºltimo estado
GET /buildings


Ejemplo real:

[
  {
    "building_id": "Serapio RendÃ³n 87",
    "last_status": "NORMAL",
    "last_lambda": 1.041020355685217
  }
]

Ver evento especÃ­fico
GET /events/{event_id}

Ver links de un evento
GET /events/{event_id}/reports

4. Base de datos
Tipo

PostgreSQL (Render Free)

ConexiÃ³n

VÃ­a variable de entorno:

DATABASE_URL


El backend no conoce el proveedor, solo el string.